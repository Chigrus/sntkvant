import pgpInit from 'pg-promise';
import { dbConnect } from '@lib/env';

const pgp = pgpInit();
let db = null;

export async function dbInit() {
    if (!db) {
        try {
            db = await pgp(dbConnect);
            await db.connect();
        } catch (e) {
            console.error('DB init error:', e);
            throw e;
        }
    }
    return db
}

export async function selectUser(login) {
    const db = await dbInit();
    return db.one('SELECT * FROM public.users WHERE user_login=$1 LIMIT 1', [login]);
};